<html>

<head>
    <meta charset="utf-8" />
    <title>Kakao 지도 시작하기</title>
    <link rel="stylesheet" href="sidebar.css" type="text/css">
</head>

<body>
    <div class="map_wrap">
        <div id="map" style="width:100%; height:100%; position:relative; overflow:hidden;"></div>
        <input type="checkbox" id="L_menuicon">
    <label for="L_menuicon">
      <span></span>
      <span></span>
      <span></span>
    </label>
    <div class="L_sidebar">
        <div id="menu_wrap" class="bg_white">
            <div class="option">
                <div>
                    <form onsubmiy="searchPlaces(); return false">
                    <input type="text" id="searchbox" placeholder="검색">
                    <button type="submit">검색하기</button>
                    </form>
                </div>
            </div>
            <hr>
            <ul id="placesList"></ul>
            <div id="pagination"></div>
        </div>
        <h3>장소 입력하기</h3>
        <span class="spot_num">1</span>
        <input type="text" class="search" placeholder="장소 입력">
        <div id="spot_section">            
        </div>
        <button type="button" onclick="create_spotbox()" id="plus_box">+</button>
        <button type="button" onclick="show_mid_loc()" id="send_loc_box">중간장소 계산하기</button>
    </div>

    <input type="checkbox" id="R_menuicon">
    <label for="R_menuicon">
      <span></span>
      <span></span>
      <span></span>
    </label>
    <div class="R_sidebar">

    </div>
    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=9519a3a3b045964f59f79d575c08a44f"></script>
    <script>
        var num_spot = 1;
        const selectionElement = document.getElementById('spot_section');

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
            mapOption = { 
                center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };

        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
        /*
        var ps = new kakao.maps.services.Places();//장소 검색 객체 생성합니다

        var infowindow = new kakao.maps.InfoWindow({zindex:1})//검색 결과 목록이나 마커를 클릭했을 때 장소명을 표출할 인포윈도우를 생성합니다.

        function searchPlaces(){
            var keywaord = document.getElementById('searchbox').value;

            if(!keyword.replace(/^\s+|\s+$/g, '')){
                alert('키워드를 입력해주세요!');
                return false;
            }
            //장소 검색 객체를 통해 키워드로 장소검색을 요청합니다
            ps.keywordSearch(keywaord, placesSearchCB);
        }

        // 장소검색이 완료됐을 때 호출되는 콜백함수 입니다
        function placesSearchCB(data, status, pagination) {
            if (status === kakao.maps.services.Status.OK) {

                // 정상적으로 검색이 완료됐으면
                // 검색 목록과 마커를 표출합니다
                displayPlaces(data);

                // 페이지 번호를 표출합니다
                displayPagination(pagination);

            } else if (status === kakao.maps.services.Status.ZERO_RESULT) {

                alert('검색 결과가 존재하지 않습니다.');
                return;

            } else if (status === kakao.maps.services.Status.ERROR) {

                alert('검색 결과 중 오류가 발생했습니다.');
                return;

            }
        }
        */

        var locations = new Array();
        
        // 지도를 클릭했을때 클릭한 위치에 마커를 추가하도록 지도에 클릭이벤트를 등록합니다
        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        
            // 클릭한 위치에 마커를 표시합니다 
            addMarker(mouseEvent.latLng);    
            
            /*************임시************/
            //console.log(mouseEvent.latLng['La']);

            var location = new Object();
            
            location.lat = mouseEvent.latLng['La'];
            location.lng = mouseEvent.latLng['Ma'];

            locations.push(location);

        });

        function show_mid_loc() {
            $.ajax({ 
                type: POST, 
                url : "/calculateML.py", 
                data: JSON.stringify(locations), 
                dataType:"json", 
                success : function(data, status, xhr) { 
                    console.log(data); 
                }, 
                error: function(jqXHR, textStatus, errorThrown) { 
                    console.log(jqXHR.responseText); 
                } 
            });
        }

        // 지도에 표시된 마커 객체를 가지고 있을 배열입니다
        var markers = [];

        // 마커 하나를 지도위에 표시합니다 
        addMarker(new kakao.maps.LatLng(33.450701, 126.570667));

        // 마커를 생성하고 지도위에 표시하는 함수입니다
        function addMarker(position) {
            
            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                position: position
            });

            // 마커가 지도 위에 표시되도록 설정합니다
            marker.setMap(map);
            
            // 생성된 마커를 배열에 추가합니다
            markers.push(marker);
        }

        //plus button add search text box
        function create_spotbox() {
            /*
              let newDIV = document.createElement("div");
              let span = document.createElement("span");
              let input = document.createElement("input");
              let parent = document.getElementById("spot_section");
              newDIV.setAttribute("class", "spot");
              span.innerHTML("1");
              input.type = "text";
              newDIV.appendChild(span);
              newDIV.appendChild(input);
              parent.appendChild(newDIV);
              */
            let parser = new DOMParser();
            const code = `<div class="spot">\
                <span class="spot_num">${++num_spot}</span>
                <input type="text" placeholder="장소 입력">\
                </div>`;
            const newElement = parser.parseFromString(code, 'text/html').body.children[0];
            selectionElement.append(newElement);
        }
    </script>
</body>

</html>